generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Mensagem {
  id       Int      @id @default(autoincrement())
  conteudo String
  criadoEm DateTime @default(now())
}

model DiagnosticoInicial {
  id                    String  @id @default(uuid())
  cnpj                  String  @unique
  razaoSocial           String
  nomeFantasia          String?
  uf                    String
  municipio             String
  dataAbertura          String
  atividadePrincipal    Json
  atividadesSecundarias Json?
  naturezaJuridica      String
}

model MEI {
  id_mei               Int       @id @default(autoincrement())
  cnpj_mei             String    @unique @db.VarChar(18)
  data_abertura        DateTime  @db.Date
  uf_mei               String    @db.Char(2)
  razao_social         String    @db.VarChar(255)
  nome_fantasia        String    @db.VarChar(255)
  municipio_mei        String    @db.VarChar(255)
  cnae_principal       String    @db.Char(9)
  natureza_juridica    String    @db.VarChar(150)
  possui_filial        Boolean
  qtd_funcionario      Int
  paga_acima_piso      Boolean
  participa_outra_empresa Boolean
  faturamento_12m      Decimal   @db.Decimal(8, 2)
  compras_12m          Decimal   @db.Decimal(8, 2)
  exporta_acima_limite Boolean

  diagnostico          DIAGNOSTICO?
  usuarios             USUARIO[]
  meiCnaeSecundario    MEI_CNAE_SECUNDARIO[]

  @@index([cnae_principal])
}

model DIAGNOSTICO {
  id_mei           Int      @id
  resultado_diag   String   @db.VarChar(255)
  atualizado_em    DateTime @db.Timestamp(0)
  motivos_resultado String  @db.Text

  mei              MEI      @relation(fields: [id_mei], references: [id_mei])
}

model CNAE {
  cnae               String   @id @db.Char(9)
  ocupacao_cnae      String   @db.Text
  descricao_subclasse String  @db.Text
  iss_cnae           Boolean
  icms_cnae          Boolean

  meiCnaeSecundario  MEI_CNAE_SECUNDARIO[]

  @@index([cnae])
  @@index([cnae, ocupacao_cnae])
  @@index([cnae, descricao_subclasse])
}

model USUARIO {
  id_user        Int     @id @default(autoincrement())
  id_mei         Int     @unique
  nome_user      String  @db.Text
  email_user     String  @unique @db.Text
  cnpj_user      String  @unique @db.VarChar(18)
  senha_user     String  @db.Text
  celular_user   String  @db.VarChar(14)

  mei            MEI     @relation(fields: [id_mei], references: [id_mei])
}

model MEI_CNAE_SECUNDARIO {
  id_mei            Int
  cnae              String  @db.Char(9)
  descricao_subclasse String  @db.Text

  mei               MEI     @relation(fields: [id_mei], references: [id_mei])
  cnaeRel           CNAE    @relation(fields: [cnae], references: [cnae])

  @@id([id_mei, cnae])
}
